import{b as ce,c as lt,e as de,f as pe,g as st,i as me,j as ue}from"./chunk-TRFGNSVE.js";import{A as R,C as nt,D as J,v as Ge,y as Qe,z as Ze}from"./chunk-4LDEAX52.js";import{$ as B,B as qe,C as Je,G as Xe,H as ae,J as Ke,K as Ye,N as ke,S as E,W as et,X as re,Y as Ee,Z as tt,ba as le,ca as it,na as $,o as He,r as Ue,ra as ot,ua as at,va as se,w as We,xa as rt,y as ze}from"./chunk-W2XVHOKV.js";import{$b as j,Ab as W,Bb as z,Bc as Ve,Cb as g,Db as l,Eb as s,Fb as _,Ib as D,Kb as w,Lb as c,Sa as a,Xb as q,Zb as Ae,_ as ie,_b as C,ab as F,ac as M,bc as we,cc as Ie,da as S,db as ne,dc as Te,ec as Ne,fc as Oe,gc as Pe,ia as T,ja as k,kc as Le,lc as v,mc as y,nc as oe,ra as ye,rb as A,rc as N,ub as Re,vc as O,wb as m,xb as u,yb as $e}from"./chunk-VPP3P5XC.js";import{e as mt,f as ut}from"./chunk-HZ6M6AS2.js";var ct=mt((je,Me)=>{"use strict";(function(n,t){typeof define=="function"&&define.amd?define([],t):typeof je<"u"?t():(t(),n.FileSaver={})})(je,function(){"use strict";function n(r,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob(["\uFEFF",r],{type:r.type}):r}function t(r,d,b){var p=new XMLHttpRequest;p.open("GET",r),p.responseType="blob",p.onload=function(){h(p.response,d,b)},p.onerror=function(){console.error("could not download file")},p.send()}function e(r){var d=new XMLHttpRequest;d.open("HEAD",r,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function i(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(d)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,f=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(r,d,b){var p=o.URL||o.webkitURL,x=document.createElement("a");d=d||r.name||"download",x.download=d,x.rel="noopener",typeof r=="string"?(x.href=r,x.origin===location.origin?i(x):e(x.href)?t(r,d,b):i(x,x.target="_blank")):(x.href=p.createObjectURL(r),setTimeout(function(){p.revokeObjectURL(x.href)},4e4),setTimeout(function(){i(x)},0))}:"msSaveOrOpenBlob"in navigator?function(r,d,b){if(d=d||r.name||"download",typeof r!="string")navigator.msSaveOrOpenBlob(n(r,b),d);else if(e(r))t(r,d,b);else{var p=document.createElement("a");p.href=r,p.target="_blank",setTimeout(function(){i(p)})}}:function(r,d,b,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof r=="string")return t(r,d,b);var x=r.type==="application/octet-stream",H=/constructor/i.test(o.HTMLElement)||o.safari,I=/CriOS\/[\d]+/.test(navigator.userAgent);if((I||x&&H||f)&&typeof FileReader<"u"){var U=new FileReader;U.onloadend=function(){var te=U.result;te=I?te:te.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=te:location=te,p=null},U.readAsDataURL(r)}else{var Be=o.URL||o.webkitURL,Ce=Be.createObjectURL(r);p?p.location=Ce:location.href=Ce,p=null,setTimeout(function(){Be.revokeObjectURL(Ce)},4e4)}});o.saveAs=h.saveAs=h,typeof Me<"u"&&(Me.exports=h)})});var X=class X{transform(t,e){if(e==null)return t.toFraction();if(e===-2)return Math.round(t.mul(E(100n)).toNumber()).toLocaleString();if(t.isInteger()){let o=t.toLocaleString();return e>0&&(o+=" ".repeat(e+1)),o}let i=t.toLocaleString(e,!0);if(e>0){let o=E(1,Math.pow(10,e));t.gt(E.zero)&&t.lt(o)&&(i=`<${i}`)}return i}};X.\u0275fac=function(e){return new(e||X)},X.\u0275pipe=ne({name:"rate",type:X,pure:!0});var fe=X;var De=ut(ct(),1);var dt=["Item","Items","Surplus","Inputs","Outputs","Targets","Belts","Belt","Wagons","Wagon","Rockets","Recipe","Machines","Machine","Modules","Beacons","Power","Pollution"];var ft="text/csv;charset=UTF-8",_t=".csv",gt="text/json;charset=UTF-8",ht=".json",L=class L{constructor(){this.adjustment=S(at);this.itemsStore=S(ot);this.recipesStore=S(se);this.settingsStore=S($);this.itemsState=this.itemsStore.settings;this.recipesState=this.recipesStore.settings;this.columnsState=this.settingsStore.columnsState;this.data=this.recipesStore.adjustedDataset}stepsToCsv(t){let e=t.map(f=>this.stepToJson(f,t)),i=dt.filter(f=>e.some(h=>h[f]!=null)),o=e.map(f=>i.map(h=>f[h]).join(","));o.unshift(i.join(",")),o.unshift(`"${window.location.href}"`),this.saveAsCsv(o.join(`\r
`),"factoriolab_list")}flowToJson(t){this.saveAsJson(JSON.stringify(t),"factoriolab_flow")}saveAsCsv(t,e){(0,De.saveAs)(new Blob([t],{type:ft}),e+_t)}saveAsJson(t,e){(0,De.saveAs)(new Blob([t],{type:gt}),e+ht)}stepToJson(t,e){let i=this.columnsState(),o=this.itemsState(),f=this.recipesState(),h=this.data(),r={};if(t.itemId!=null){r.Item=t.itemId;let d=o[t.itemId];t.items!=null&&(r.Items="="+t.items.sub(t.surplus??E.zero).toString()),t.surplus!=null&&(r.Surplus="="+t.surplus.toString()),i.belts.show&&(t.belts!=null&&(r.Belts="="+t.belts.toString()),r.Belt=d.beltId),i.wagons.show&&(t.wagons!=null&&(r.Wagons="="+t.wagons.toString()),r.Wagon=d.wagonId),i.rockets.show&&t.rockets!=null&&(r.Rockets="="+t.rockets.toString())}if(t.recipeId!=null){r.Recipe=t.recipeId;let d=h.adjustedRecipe[t.recipeId],b=f[t.recipeId],p=Object.keys(d.in).map(x=>{let H=e.find(I=>I.itemId===x);return[x,H?.parents?.[t.id]?.toString()??""]}).filter(x=>x[1]).map(x=>`${x[0]}:${x[1]}`).join(",");if(p&&(r.Inputs=`"${p}"`),b.machineId!=null){let x=h.machineRecord[b.machineId],H=this.adjustment.allowsModules(d,x);i.machines.show&&(t.machines!=null&&(r.Machines="="+t.machines.toString()),r.Machine=b.machineId,H&&b.modules!=null&&(r.Modules=`"${b.modules.filter(le("count","id")).map(I=>`${I.count.toString()} ${I.id}`).join(",")}"`)),i.beacons.show&&H&&(r.Beacons=`"${B(b.beacons?.map(I=>`${B(I.count?.toString(),"")} ${B(I.id,"")} (${B(I.modules?.filter(le("count","id")).map(U=>`${U.count.toString()} ${U.id}`).join(","),"")})`).join(","),"")}"`),i.power.show&&t.power!=null&&(r.Power="="+t.power.toString()),i.pollution.show&&t.pollution!=null&&(r.Pollution="="+t.pollution.toString())}}if(t.outputs!=null){let d=t.outputs,b=Object.keys(d).map(p=>`${p}:${d[p].toString()}`).join(",");r.Outputs=`"${b}"`}if(t.parents!=null){let d=t.parents,b=Object.keys(d).map(p=>e.find(x=>x.id===p)).filter(it).filter(le("recipeId")).map(p=>`${p.recipeId}:${d[p.id].toString()}`).join(",");r.Targets=`"${b}"`}return r}};L.\u0275fac=function(e){return new(e||L)},L.\u0275prov=ie({token:L,factory:L.\u0275fac,providedIn:"root"});var _e=L;function K(n,t,e){return e=new Set(e),Array.isArray(n)||(n=[n]),n.forEach(i=>{t?e.add(i):e.delete(i)}),e}var pt=E(2n,3n),xt=pt.toFraction(),Y=class Y{transform(t){return t==null?xt:pt.toLocaleString(t)}};Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275pipe=ne({name:"precisionExample",type:Y,pure:!0});var ge=Y;var bt=(n,t)=>t.value;function vt(n,t){n&1&&(C(0),v(1,"translate")),n&2&&M(" ",y(1,1,"columns.notApplicable")," ")}function Ct(n,t){n&1&&(C(0),v(1,"translate")),n&2&&M(" ",y(1,1,"columns.hidden")," ")}function yt(n,t){if(n&1&&(l(0,"td",9),m(1,vt,2,3)(2,Ct,2,3),s()),n&2){let e=c().$implicit,i=c();a(),u(i.columnsInfo[e.value].hasPrecision?2:1)}}function wt(n,t){if(n&1){let e=D();l(0,"td",10)(1,"input",11),Te("ngModelChange",function(o){T(e);let f=c().$implicit,h=c();return Ie(h.value[f.value].precision,o)||(h.value[f.value].precision=o),k(o)}),s()(),l(2,"td",12)(3,"input",13),w("ngModelChange",function(o){T(e);let f=c().$implicit,h=c();return k(h.value[f.value].precision=o?null:1)}),s()(),l(4,"td",14),C(5),v(6,"precisionExample"),s()}if(n&2){let e=c().$implicit,i=c();a(),we("ngModel",i.value[e.value].precision),a(2),g("ngModel",i.value[e.value].precision==null),a(2),M(" ",y(6,3,i.value[e.value].precision)," ")}}function It(n,t){if(n&1){let e=D();l(0,"tr")(1,"td")(2,"div",6)(3,"input",7),Te("ngModelChange",function(o){let f=T(e).$implicit,h=c();return Ie(h.value[f.value].show,o)||(h.value[f.value].show=o),k(o)}),w("ngModelChange",function(){T(e);let o=c();return k(o.ref.markForCheck())}),s(),l(4,"label",8),C(5),v(6,"translate"),s()()(),m(7,yt,3,1,"td",9)(8,wt,7,5),s()}if(n&2){let e=t.$implicit,i=c();a(2),q("opacity-40",e.disabled),a(),we("ngModel",i.value[e.value].show),g("disabled",!!e.disabled),A("id",e.value),a(),g("for",e.value),a(),j(y(6,8,e.label)),a(2),u(!i.columnsInfo[e.value].hasPrecision||!i.value[e.value].show?7:8)}}function Tt(n,t){if(n&1){let e=D();l(0,"button",15),w("click",function(){T(e);let o=c();return k(o.reset())}),s()}if(n&2){let e=c();g("faIcon",e.faRotateLeft)}}var G=class G{constructor(){this.ref=S(Ve);this.dialogRef=S(Ge);this.preferencesStore=S(tt);this.settingsStore=S($);this.columnsInfo=et;this.faCheck=qe;this.faRotateLeft=ae;this.faXmark=Je;this.value=Ee(this.settingsStore.columnsState())}get modified(){return Object.keys(this.value).some(t=>this.value[t].precision!==re[t].precision||this.value[t].show!==re[t].show)}reset(){this.value=Ee(re)}save(){this.preferencesStore.apply({columns:this.value}),this.dialogRef.close()}};G.\u0275fac=function(e){return new(e||G)},G.\u0275cmp=F({type:G,selectors:[["lab-columns-dialog"]],hostAttrs:[1,"flex","flex-col","p-3","sm:p-6","pt-0","gap-3","sm:gap-6","sm:pt-0","overflow-hidden"],decls:23,vars:15,consts:[[1,"overflow-auto"],[1,"table","w-sm"],[1,"flex","justify-end","gap-1","sm:gap-2"],["type","button","labButton","","text","reset",3,"faIcon"],["type","button","labButton","","text","ok","color","brand",3,"click","faIcon"],["type","button","labButton","","text","cancel",3,"click","faIcon"],[1,"flex","items-center","gap-2"],["type","checkbox","step","1",1,"checkbox",3,"ngModelChange","ngModel","disabled"],[3,"for"],["colspan","3",1,"text-center"],[1,"w-20"],["type","number",1,"input",3,"ngModelChange","ngModel"],[1,"text-center"],["type","checkbox",1,"checkbox",3,"ngModelChange","ngModel"],[1,"text-center","font-mono"],["type","button","labButton","","text","reset",3,"click","faIcon"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th"),C(5),v(6,"translate"),s(),l(7,"th"),C(8),v(9,"translate"),s(),l(10,"th"),C(11),v(12,"translate"),s(),l(13,"th"),C(14),v(15,"translate"),s()()(),l(16,"tbody"),W(17,It,9,10,"tr",null,bt),s()()(),l(19,"div",2),m(20,Tt,1,1,"button",3),l(21,"button",4),w("click",function(){return i.save()}),s(),l(22,"button",5),w("click",function(){return i.dialogRef.close()}),s()()),e&2&&(a(5),j(y(6,7,"columns.visibility")),a(3),j(y(9,9,"columns.decimals")),a(3),j(y(12,11,"columns.fractions")),a(3),j(y(15,13,"columns.example")),a(3),z(i.settingsStore.columnOptions()),a(3),u(i.modified?20:-1),a(),g("faIcon",i.faCheck),a(),g("faIcon",i.faXmark))},dependencies:[me,lt,st,ce,de,pe,J,ge,R],encapsulation:2,changeDetection:0});var he=G;var V=class V{constructor(){this.dialog=S(Qe)}show(){this.dialog.open(he,{data:{header:"columns.header"}})}};V.\u0275fac=function(e){return new(e||V)},V.\u0275prov=ie({token:V,factory:V.\u0275fac,providedIn:"root"});var xe=V;var Q=class Q{constructor(){this.settingsStore=S($);this.itemId=O.required();this.faEyeSlash=Ye;this.excluded=N(()=>this.settingsStore.settings().excludedItemIds.has(this.itemId()));this.tooltip=N(()=>this.excluded()?"steps.includeItemTooltip":"steps.excludeItemTooltip")}changeItemExcluded(){let t=this.itemId(),e=this.settingsStore.settings().excludedItemIds,i=!e.has(t);e=K(t,i,e),this.settingsStore.apply({excludedItemIds:e})}};Q.\u0275fac=function(e){return new(e||Q)},Q.\u0275cmp=F({type:Q,selectors:[["lab-exclude-button"]],inputs:{itemId:[1,"itemId"]},decls:2,vars:9,consts:[["type","button","labButton","","iconType","item","labTooltipType","item","labTooltipPosition","adjacent",1,"bg-gray-950",3,"click","icon","toggleIcon","toggled","border","labTooltip","labTooltipAction"]],template:function(e,i){e&1&&(l(0,"button",0),v(1,"translate"),w("click",function(){return i.changeItemExcluded()}),s()),e&2&&(g("icon",i.itemId())("toggleIcon",i.faEyeSlash)("toggled",i.excluded())("border",!1)("labTooltip",i.itemId())("labTooltipAction",i.tooltip()),A("aria-label",y(1,7,i.tooltip())))},dependencies:[J,ue,R],encapsulation:2,changeDetection:0});var Se=Q;var kt=["lab-sort-header",""],Z=class Z{constructor(){this.steps=S(ve);this.text=O.required();this.column=O.required();this.icon=N(()=>{let t=this.steps.sort();if(t==null)return ke;let[e,i]=t;return e!==this.column()?ke:i===1?Ke:Xe})}};Z.\u0275fac=function(e){return new(e||Z)},Z.\u0275cmp=F({type:Z,selectors:[["th","lab-sort-header",""],["th","labSortHeader",""]],hostAttrs:[1,"cursor-pointer","select-none","hover:bg-gray-700"],hostVars:2,hostBindings:function(e,i){if(e&1&&w("click",function(){return i.steps.changeSort(i.column())}),e&2){let o;q("text-brand-400",((o=i.steps.sort())==null?null:o[0])===i.column())}},inputs:{text:[1,"text"],column:[1,"column"]},attrs:kt,decls:4,vars:4,consts:[[1,"flex","justify-between"],[3,"icon"]],template:function(e,i){e&1&&(l(0,"div",0),C(1),v(2,"translate"),_(3,"fa-icon",1),s()),e&2&&(a(),M(" ",y(2,2,i.text())," "),a(2),g("icon",i.icon()))},dependencies:[Ze,R],encapsulation:2,changeDetection:0});var be=Z;var Et=(n,t,e,i,o,f)=>({"border-e-2":n,"ms-2":t,"ms-4":e,"sm:ms-4.5":i,"sm:ms-6":o,"h-12.5":f}),jt=(n,t)=>t.id,Mt=(n,t)=>t.label;function Dt(n,t){if(n&1){let e=D();l(0,"button",12),w("click",function(){T(e);let o=c();return k(o.exporter.stepsToCsv(o.objectivesStore.steps()))}),s()}if(n&2){let e=c();g("faIcon",e.faFileArrowDown)}}function Ft(n,t){if(n&1){let e=D();l(0,"th",4)(1,"div",13)(2,"button",14),v(3,"translate"),w("click",function(){T(e);let o=c();return k(o.resetChecked())}),s()()()}if(n&2){let e=c(),i=!e.settings().checkedItemIds.size&&!e.settings().checkedRecipeIds.size&&!e.settings().checkedObjectiveIds.size;a(2),g("faIcon",i?e.faSquareCheck:e.faRotateLeft)("labTooltip",i?"":"steps.checkedUndoTooltip")("disabled",i)("border",!i),A("aria-label",y(3,5,"steps.checkedUndoTooltip"))}}function Bt(n,t){n&1&&(l(0,"th"),C(1),v(2,"translate"),s()),n&2&&(a(),j(y(2,1,"options.column.tree")))}function Rt(n,t){n&1&&_(0,"th",6)}function $t(n,t){if(n&1&&_(0,"th",7),n&2){let e=c();g("text",e.displayRateInfo().wagonsLabel)}}function At(n,t){if(n&1&&_(0,"th",8),n&2){let e=c();g("text",e.displayRateInfo().rocketsLabel)}}function Nt(n,t){n&1&&(l(0,"th"),C(1),v(2,"translate"),s()),n&2&&(a(),j(y(2,1,"options.column.beacons")))}function Ot(n,t){n&1&&_(0,"th",10)}function Pt(n,t){if(n&1&&_(0,"th",11),n&2){let e=c();g("text",e.displayRateInfo().pollutionLabel)}}function Lt(n,t){n&1&&_(0,"th")}function Vt(n,t){if(n&1&&_(0,"div",15),n&2){let e=t.$implicit;c();let i=Pe(2);g("id",i+"_"+e.label)}}function Ht(n,t){if(n&1){let e=D();l(0,"td")(1,"div",25)(2,"input",26),w("ngModelChange",function(o){T(e);let f=c().$implicit,h=c();return k(h.changeStepChecked(f,o))}),s()()()}if(n&2){let e=c().$implicit;a(2),g("ngModel",e.checked)}}function Ut(n,t){if(n&1&&_(0,"div",33),n&2){let e=t.$implicit,i=t.$index,o=t.$count;Ae(Le(2,Et,e||i===o-1,i===0,i!==0,i===0,i!==0,e||i===o-1))}}function Wt(n,t){if(n&1&&(W(0,Ut,1,9,"div",31,$e),_(2,"div",32)),n&2){let e=c(2).$implicit,i=c();z(i.tree()[e.id])}}function zt(n,t){if(n&1&&_(0,"lab-exclude-button",29),n&2){let e=c(2).$implicit;g("itemId",e.itemId)}}function qt(n,t){if(n&1&&_(0,"lab-icon",30),n&2){let e=c(2).$implicit;g("value",e.recipeId)("text","#"+e.recipeObjectiveId)("labTooltip",e.recipeId)("labTooltipAdjustedRecipe",e.recipe)}}function Jt(n,t){if(n&1&&(l(0,"td",17)(1,"div",27),m(2,Wt,3,0),l(3,"div",28),m(4,zt,1,1,"lab-exclude-button",29)(5,qt,1,4,"lab-icon",30),s()()()),n&2){let e=c().$implicit,i=c();a(2),u(i.sort()==null&&i.tree()[e.id].length?2:-1),a(2),u(e.itemId&&e.recipeObjectiveId==null?4:e.recipeId?5:-1)}}function Xt(n,t){if(n&1&&(l(0,"div",18),C(1),v(2,"rate"),s()),n&2){let e=c().$implicit,i=c();a(),M(" (+",oe(2,1,e.surplus,i.cols().items.precision),") ")}}function Kt(n,t){if(n&1&&(l(0,"div",20),C(1),v(2,"rate"),s()),n&2){let e=c().$implicit,i=c();a(),M(" ",oe(2,1,e.items,i.cols().items.precision)," ")}}function Yt(n,t){if(n&1&&(l(0,"div",22)(1,"span",34),C(2),s(),_(3,"lab-exclude-button",29),s()),n&2){let e=c().$implicit,i=c();a(2),j(i.data().itemRecord[e.itemId].name),a(),g("itemId",e.itemId)}}function Gt(n,t){n&1&&_(0,"td")(1,"td")}function Qt(n,t){n&1&&_(0,"td")(1,"td")}function Zt(n,t){n&1&&_(0,"td")(1,"td")}function ei(n,t){if(n&1&&(l(0,"div",20),C(1),v(2,"rate"),s()),n&2){let e=c(2).$implicit,i=c();a(),M(" ",oe(2,1,e.machines,i.cols().machines.precision)," ")}}function ti(n,t){if(n&1&&(l(0,"td",35),m(1,ei,3,4,"div",20),s(),l(2,"td",21)(3,"div",13),_(4,"lab-icon",36),s()()),n&2){let e=t,i=c().$implicit,o=c();a(),u(i.machines&&i.machines.nonzero()&&!o.data().machineRecord[e].hideRate?1:-1),a(3),g("value",e)}}function ii(n,t){n&1&&_(0,"td",23)}function ni(n,t){n&1&&_(0,"td")}function oi(n,t){n&1&&_(0,"td")}function ai(n,t){n&1&&_(0,"td")}function ri(n,t){n&1&&_(0,"td")}function li(n,t){n&1&&(l(0,"tr",24),Re("animate-enter-translate-y"),l(1,"td",37),C(2,"expansion row"),s()())}function si(n,t){if(n&1){let e=D();l(0,"tr")(1,"td"),Ne(2),_(3,"div",15),W(4,Vt,1,1,"div",15,Mt),l(6,"div",13)(7,"button",16),v(8,"translate"),w("click",function(){let o=T(e).$implicit,f=c();return k(f.toggleStep(o))}),s()()(),m(9,Ht,3,1,"td"),m(10,Jt,6,2,"td",17),l(11,"td"),m(12,Xt,3,4,"div",18),s(),l(13,"td",19),m(14,Kt,3,4,"div",20),s(),l(15,"td",21),m(16,Yt,4,2,"div",22),s(),m(17,Gt,2,0),m(18,Qt,2,0),m(19,Zt,2,0),m(20,ti,5,2)(21,ii,1,0,"td",23),m(22,ni,1,0,"td"),m(23,oi,1,0,"td"),m(24,ai,1,0,"td"),m(25,ri,1,0,"td"),s(),m(26,li,3,0,"tr",24)}if(n&2){let e,i=t.$implicit,o=c(),f=o.expandedSteps().has(i.id);a(2);let h=Oe("step_"+i.id);a(),g("id",h),a(),z(o.objectivesStore.stepDetails()[i.id].tabs);let r=f?"steps.hideDetails":"steps.showDetails";a(3),q("*:rotate-90",f),g("faIcon",o.faAngleRight)("border",!1)("labTooltip",r),A("aria-label",y(8,22,r)),a(2),u(o.cols().checkbox.show?9:-1),a(),u(!o.focus()&&o.cols().tree.show?10:-1),a(2),u(i.surplus?12:-1),a(2),u(i.items?14:-1),a(2),u(i.itemId?16:-1),a(),u(o.cols().belts.show?17:-1),a(),u(o.cols().wagons.show?18:-1),a(),u(o.cols().rockets.show?19:-1),a(),u((e=i.recipeSettings==null?null:i.recipeSettings.machineId)?20:21,e),a(2),u(o.cols().beacons.show?22:-1),a(),u(o.cols().power.show?23:-1),a(),u(o.cols().pollution.show?24:-1),a(),u(o.cols().link.show?25:-1),a(),u(f?26:-1)}}var ee=class ee{constructor(){this.columns=S(xe);this.exporter=S(_e);this.objectivesStore=S(rt);this.recipesStore=S(se);this.settingsStore=S($);this.focus=O(!1);this.cols=this.settingsStore.columnsState;this.data=this.recipesStore.adjustedDataset;this.displayRateInfo=this.settingsStore.displayRateInfo;this.faAngleRight=ze;this.faFileArrowDown=He;this.faRotateLeft=ae;this.faSquareCheck=We;this.faTableColumns=Ue;this.settings=this.settingsStore.settings;this.tree=this.objectivesStore.stepTree;this.expandedSteps=ye(new Set);this.sort=ye(null);this.sortedSteps=N(()=>{let t=this.sort(),e=this.objectivesStore.steps();if(t==null)return e;let[i,o]=t;return e=[...e],e.sort((f,h)=>B(h[i],E.zero).sub(B(f[i],E.zero)).toNumber()*o),e})}changeSort(t){this.sort.update(e=>e==null||e[0]!==t?[t,1]:e[1]===-1?null:[t,-1])}toggleStep(t){this.expandedSteps.update(e=>e.has(t.id)?new Set(Array.from(e).filter(i=>i!==t.id)):new Set([...Array.from(e),t.id]))}changeStepChecked(t,e){if(t.itemId!=null){let i=K(t.itemId,e,this.settings().checkedItemIds);this.settingsStore.apply({checkedItemIds:i})}else if(t.recipeObjectiveId!=null){let i=K(t.recipeObjectiveId,e,this.settings().checkedObjectiveIds);this.settingsStore.apply({checkedObjectiveIds:i})}else if(t.recipeId!=null){let i=K(t.recipeId,e,this.settings().checkedRecipeIds);this.settingsStore.apply({checkedRecipeIds:i})}}resetChecked(){this.settingsStore.apply({checkedItemIds:new Set,checkedObjectiveIds:new Set,checkedRecipeIds:new Set})}};ee.\u0275fac=function(e){return new(e||ee)},ee.\u0275cmp=F({type:ee,selectors:[["lab-steps"]],hostAttrs:[1,"flex","flex-col","gap-1","sm:gap-2"],inputs:{focus:[1,"focus"]},decls:21,vars:12,consts:[[1,"flex","gap-1","sm:gap-2"],["type","button","labButton","","text","columns.header",3,"click","faIcon"],["type","button","labButton","","text","steps.downloadAsCsv",3,"faIcon"],[1,"table"],[1,"w-0"],["colspan","3","labSortHeader","","column","items",3,"text"],["colspan","2","labSortHeader","","text","options.column.belts","column","belts"],["colspan","2","labSortHeader","","column","wagons",3,"text"],["colspan","2","labSortHeader","","column","rockets",3,"text"],["colspan","2","labSortHeader","","text","options.column.machines","column","machines"],["labSortHeader","","text","options.column.power","column","power"],["labSortHeader","","column","pollution",3,"text"],["type","button","labButton","","text","steps.downloadAsCsv",3,"click","faIcon"],[1,"flex"],["type","button","labButton","",3,"click","faIcon","labTooltip","disabled","border"],[1,"hidden",3,"id"],["type","button","labButton","","labTooltipPosition","adjacent",1,"*:transition-transform",3,"click","faIcon","border","labTooltip"],[1,"px-0","py-0","sm:px-2"],[1,"text-brand-400","flex","justify-end","font-mono","whitespace-pre"],[1,"w-0","pe-0"],[1,"flex","justify-end","font-mono","whitespace-pre"],[1,"ps-0"],[1,"relative","flex"],["colspan","2"],[1,"transition-all"],[1,"flex","justify-center"],["type","checkbox",1,"checkbox",3,"ngModelChange","ngModel"],[1,"flex","h-12","items-center"],[1,"flex","flex-col","items-center"],[3,"itemId"],["type","recipe","labTooltipType","recipe","labTooltipPosition","adjacent",3,"value","text","labTooltip","labTooltipAdjustedRecipe"],[1,"-z-1","mb-6","self-end","border-dotted","border-gray-50",3,"class"],[1,"w-2","border-t-2","border-dotted","border-gray-50"],[1,"-z-1","mb-6","self-end","border-dotted","border-gray-50"],["aria-hidden","true",1,"absolute","top-1","text-transparent","select-none"],[1,"pe-0"],["type","item",3,"value"],["colspan","100"]],template:function(e,i){e&1&&(l(0,"div",0)(1,"button",1),w("click",function(){return i.columns.show()}),s(),m(2,Dt,1,1,"button",2),s(),l(3,"table",3)(4,"thead")(5,"tr"),_(6,"th",4),m(7,Ft,4,7,"th",4),m(8,Bt,3,3,"th"),_(9,"th",5),m(10,Rt,1,0,"th",6),m(11,$t,1,1,"th",7),m(12,At,1,1,"th",8),_(13,"th",9),m(14,Nt,3,3,"th"),m(15,Ot,1,0,"th",10),m(16,Pt,1,1,"th",11),m(17,Lt,1,0,"th"),s()(),l(18,"tbody"),W(19,si,27,24,null,null,jt),s()()),e&2&&(a(),g("faIcon",i.faTableColumns),a(),u(i.objectivesStore.steps().length?2:-1),a(5),u(i.cols().checkbox.show?7:-1),a(),u(!i.focus()&&i.cols().tree.show?8:-1),a(),g("text",i.displayRateInfo().itemsLabel),a(),u(i.cols().belts.show?10:-1),a(),u(i.cols().wagons.show?11:-1),a(),u(i.cols().rockets.show?12:-1),a(2),u(i.cols().beacons.show?14:-1),a(),u(i.cols().power.show?15:-1),a(),u(i.cols().pollution.show?16:-1),a(),u(i.cols().link.show?17:-1),a(2),z(i.sortedSteps()))},dependencies:[me,ce,de,pe,J,Se,nt,ue,be,fe,R],encapsulation:2,changeDetection:0});var ve=ee;export{ve as Steps};
